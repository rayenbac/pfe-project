<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && user" class="dashboard-content">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="user-welcome">
        <div class="user-avatar">
          <img 
            [src]="user.avatar || 'https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&fit=crop'"
            alt="{{ user.name }}"
            class="avatar-img">
        </div>
        <div class="welcome-text">
          <h1 class="welcome-title">Welcome back, {{ user.name || user.firstName + ' ' + user.lastName }}!</h1>
          <p class="welcome-subtitle">
            <span class="role-badge" [class.agent]="user.role.toLowerCase() === 'agent'">
              <i class="fas" [class.fa-building]="user.role.toLowerCase() === 'agent'" [class.fa-home]="user.role.toLowerCase() === 'user'"></i>
              {{ user.role.toLowerCase() === 'agent' ? 'Real Estate Agent' : 'Property Seeker' }}
            </span>
          </p>
        </div>
      </div>
      <div class="header-actions">
        <div class="notification-action">
          <app-notification-dropdown></app-notification-dropdown>
        </div>
        <!-- Agent actions -->
        <button *ngIf="user.role.toLowerCase() === 'agent'" class="btn btn-primary" (click)="navigateToAddProperty()">
          <i class="fas fa-plus me-1"></i>
          Add Property
        </button>
        <!-- User actions -->
        <button *ngIf="user.role.toLowerCase() === 'user'" class="btn btn-primary" (click)="navigateToSearchProperties()">
          <i class="fas fa-search me-1"></i>
          Search Properties
        </button>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
      <nav class="nav nav-tabs">
        <button 
          *ngFor="let tab of getVisibleTabs()"
          class="nav-link"
          [class.active]="activeTab === tab.id"
          (click)="setActiveTab(tab.id)">
          <i [class]="tab.icon + ' me-2'"></i>
          {{ tab.label }}
        </button>
      </nav>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="tab-pane active">
        <div class="overview-content">
          <h3 class="section-title">Dashboard Overview</h3>
          
          <!-- Stats Cards for AGENT -->
          <div *ngIf="user.role.toLowerCase() === 'agent'" class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-home text-primary"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.properties }}</div>
                  <div class="stat-label">My Properties</div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-calendar-check text-success"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.bookings }}</div>
                  <div class="stat-label">Active Bookings</div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-file-contract text-info"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.contracts }}</div>
                  <div class="stat-label">Active Contracts</div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-star text-warning"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.rating || 'N/A' }}</div>
                  <div class="stat-label">Average Rating</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Stats Cards for USER -->
          <div *ngIf="user.role.toLowerCase() === 'user'" class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-heart text-danger"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.favorites }}</div>
                  <div class="stat-label">Favorite Properties</div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-calendar-alt text-primary"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.bookings }}</div>
                  <div class="stat-label">My Reservations</div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-file-invoice text-success"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.invoices }}</div>
                  <div class="stat-label">Pending Invoices</div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-file-contract text-info"></i>
                </div>
                <div class="stat-details">
                  <div class="stat-value">{{ stats.contracts }}</div>
                  <div class="stat-label">Active Contracts</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Recent Activity -->
          <div class="recent-activity">
            <h4 class="mb-3">Recent Activity</h4>
            <div class="activity-list">
              <div *ngFor="let activity of recentActivities" class="activity-item">
                <div class="activity-icon">
                  <i [class]="activity.icon"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-title">{{ activity.title }}</div>
                  <div class="activity-time">{{ activity.time }}</div>
                </div>
              </div>
              
              <!-- Empty state for no activities -->
              <div *ngIf="recentActivities.length === 0" class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-info-circle text-muted"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-title">No recent activity</div>
                  <div class="activity-time">Get started by {{ user.role.toLowerCase() === 'agent' ? 'adding a property' : 'browsing properties' }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reservations Tab -->
      <div *ngIf="activeTab === 'reservations'" class="tab-pane active">
        <h3>Reservations Content</h3>
        <p>This is the reservations tab content.</p>
        <app-booking-calendar></app-booking-calendar>
      </div>

      <!-- Notifications Tab -->
      <div *ngIf="activeTab === 'notifications'" class="tab-pane active">
        <div class="notifications-tab-content">
          <app-notifications-page></app-notifications-page>
        </div>
      </div>

      <!-- Properties Tab -->
      <div *ngIf="activeTab === 'properties'" class="tab-pane active">
        <h3>Properties Content</h3>
        <p>This is the properties tab content.</p>
        <app-property-manager></app-property-manager>
      </div>

      <!-- Favorites Tab -->
      <div *ngIf="activeTab === 'favorites'" class="tab-pane active">
        <h3>Favorites Content</h3>
        <p>This is the favorites tab content.</p>
        <app-favorites-grid></app-favorites-grid>
      </div>

      <!-- Contracts Tab -->
      <div *ngIf="activeTab === 'contracts'" class="tab-pane active">
        <h3>Contracts Content</h3>
        <p>This is the contracts tab content.</p>
        <app-contracts-table></app-contracts-table>
      </div>

      <!-- Invoices Tab -->
      <div *ngIf="activeTab === 'invoices'" class="tab-pane active">
        <h3>Invoices Content</h3>
        <p>This is the invoices tab content.</p>
        <app-invoices-table></app-invoices-table>
      </div>

      <!-- Reviews Tab -->
      <div *ngIf="activeTab === 'reviews'" class="tab-pane active">
        <h3>Reviews Content</h3>
        <p>This is the reviews tab content.</p>
        <app-reviews-list></app-reviews-list>
      </div>

      <!-- Profile Settings Tab -->
      <div *ngIf="activeTab === 'profile'" class="tab-pane active">
        <h3>Profile Settings Content</h3>
        <p>This is the profile settings tab content.</p>
        <app-profile-settings></app-profile-settings>
      </div>
    </div>
  </div>
</div>