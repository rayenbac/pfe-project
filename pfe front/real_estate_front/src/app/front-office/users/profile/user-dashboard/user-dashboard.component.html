<div class="dashboard-wrapper">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="loading-text">Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && user" class="dashboard-content">
    <!-- Welcome Header -->
    <div class="welcome-header">
      <div class="welcome-content">
        <div class="user-info">
          <div class="user-avatar">
            <img [src]="user.avatar || 'https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&fit=crop'"
                 alt="{{ user.name }}"
                 class="avatar-image">
            <div class="status-indicator"></div>
          </div>
          <div class="user-details">
            <h2 class="welcome-title">Welcome back, {{ user.name || user.firstName + ' ' + user.lastName }}!</h2>
            <div class="user-role">
              <span class="role-badge" [class.agent-badge]="user.role.toLowerCase() === 'agent'">
                <i class="fas" [class.fa-building]="user.role.toLowerCase() === 'agent'" [class.fa-home]="user.role.toLowerCase() === 'user'"></i>
                {{ user.role.toLowerCase() === 'agent' ? 'Real Estate Agent' : 'Property Seeker' }}
              </span>
            </div>
          </div>
        </div>
        <div class="header-actions">
          <div class="notification-wrapper">
            <app-notification-dropdown></app-notification-dropdown>
          </div>
          <button *ngIf="user.role.toLowerCase() === 'agent'" class="btn btn-primary" (click)="navigateToAddProperty()">
            <i class="fas fa-plus me-2"></i>Add Property
          </button>
          <button *ngIf="user.role.toLowerCase() === 'user'" class="btn btn-primary" (click)="navigateToSearchProperties()">
            <i class="fas fa-search me-2"></i>Search Properties
          </button>
        </div>
      </div>
    </div>

    <!-- Dashboard Navigation -->
    <div class="dashboard-nav">
      <nav class="nav-tabs-container">
        <div class="nav-tabs">
          <button *ngFor="let tab of getVisibleTabs()"
                  class="nav-tab"
                  [class.active]="activeTab === tab.id"
                  (click)="setActiveTab(tab.id)">
            <i [class]="tab.icon"></i>
            <span>{{ tab.label }}</span>
          </button>
        </div>
      </nav>
    </div>

    <!-- Tab Content -->
    <div class="tab-content-wrapper">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="tab-content active">
        <div class="overview-section">
          <!-- Stats Cards for AGENT -->
          <div *ngIf="user.role.toLowerCase() === 'agent'" class="stats-grid">
            <div class="stat-card properties">
              <div class="stat-icon">
                <i class="fas fa-home"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.properties }}</div>
                <div class="stat-label">My Properties</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-arrow-up"></i>
              </div>
            </div>
            
            <div class="stat-card bookings">
              <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.bookings }}</div>
                <div class="stat-label">Active Bookings</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-arrow-up"></i>
              </div>
            </div>
            
            <div class="stat-card contracts">
              <div class="stat-icon">
                <i class="fas fa-file-contract"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.contracts }}</div>
                <div class="stat-label">Active Contracts</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-minus"></i>
              </div>
            </div>
            
            <div class="stat-card rating">
              <div class="stat-icon">
                <i class="fas fa-star"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.rating || 'N/A' }}</div>
                <div class="stat-label">Average Rating</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-star"></i>
              </div>
            </div>
          </div>

          <!-- Stats Cards for USER -->
          <div *ngIf="user.role.toLowerCase() === 'user'" class="stats-grid">
            <div class="stat-card favorites">
              <div class="stat-icon">
                <i class="fas fa-heart"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.favorites }}</div>
                <div class="stat-label">Favorite Properties</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-arrow-up"></i>
              </div>
            </div>
            
            <div class="stat-card reservations">
              <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.bookings }}</div>
                <div class="stat-label">My Reservations</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-arrow-up"></i>
              </div>
            </div>
            
            <div class="stat-card invoices">
              <div class="stat-icon">
                <i class="fas fa-file-invoice"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.invoices }}</div>
                <div class="stat-label">Pending Invoices</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
            </div>
            
            <div class="stat-card contracts">
              <div class="stat-icon">
                <i class="fas fa-file-contract"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ stats.contracts }}</div>
                <div class="stat-label">Active Contracts</div>
              </div>
              <div class="stat-trend">
                <i class="fas fa-check"></i>
              </div>
            </div>
          </div>
          
          <!-- Recent Activity -->
          <div class="activity-section">
            <div class="section-header">
              <h4 class="section-title">
                <i class="fas fa-clock"></i>
                Recent Activity
              </h4>
            </div>
            <div class="activity-list">
              <div *ngFor="let activity of recentActivities" class="activity-item">
                <div class="activity-icon">
                  <i [class]="activity.icon"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-title">{{ activity.title }}</div>
                  <div class="activity-time">{{ activity.time }}</div>
                </div>
              </div>
              
              <!-- Empty state for no activities -->
              <div *ngIf="recentActivities.length === 0" class="activity-item empty">
                <div class="activity-icon">
                  <i class="fas fa-info-circle"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-title">No recent activity</div>
                  <div class="activity-time">Get started by {{ user.role.toLowerCase() === 'agent' ? 'adding a property' : 'browsing properties' }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Other Tabs -->
      <div *ngIf="activeTab === 'reservations'" class="tab-content active">
        <app-booking-calendar></app-booking-calendar>
      </div>

      <div *ngIf="activeTab === 'notifications'" class="tab-content active">
        <app-notifications-page></app-notifications-page>
      </div>

      <div *ngIf="activeTab === 'properties'" class="tab-content active">
        <app-property-manager></app-property-manager>
      </div>

      <div *ngIf="activeTab === 'favorites'" class="tab-content active">
        <app-favorites-grid></app-favorites-grid>
      </div>

      <div *ngIf="activeTab === 'contracts'" class="tab-content active">
        <app-contracts-table></app-contracts-table>
      </div>

      <div *ngIf="activeTab === 'invoices'" class="tab-content active">
        <app-invoices-table></app-invoices-table>
      </div>

      <div *ngIf="activeTab === 'reviews'" class="tab-content active">
        <app-reviews-list></app-reviews-list>
      </div>

      <div *ngIf="activeTab === 'profile'" class="tab-content active">
        <app-profile-settings></app-profile-settings>
      </div>
    </div>
  </div>
</div>

<!-- Agency Modal -->
<!-- <app-agency-modal 
  [isVisible]="showAgencyModal"
  [agency]="selectedAgencyForEdit"
  [isEditing]="isEditingAgencyModal"
  (closed)="closeAgencyModal()"
  (agencyCreated)="onAgencyCreated($event)"
  (agencyUpdated)="onAgencyUpdated($event)"
></app-agency-modal> -->