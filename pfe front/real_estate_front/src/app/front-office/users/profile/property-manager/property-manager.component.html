<p>property-manager works!</p>
<div class="property-manager-container">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="page-title">
        <i class="fas fa-building me-2"></i>
        Property Management
      </h2>
      <p class="text-muted">Manage your property listings</p>
    </div>
    <button class="btn btn-primary" (click)="openModal()">
      <i class="fas fa-plus me-2"></i>
      Add New Property
    </button>
  </div>

  <!-- Message Alert -->
  <div *ngIf="message" class="alert alert-dismissible fade show" 
       [class.alert-success]="messageType === 'success'"
       [class.alert-danger]="messageType === 'error'">
    <i class="fas" [class.fa-check-circle]="messageType === 'success'" 
       [class.fa-exclamation-circle]="messageType === 'error'"></i>
    {{ message }}
    <button type="button" class="btn-close" (click)="clearMessage()"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center p-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 text-muted">Loading properties...</p>
  </div>

  <!-- Properties Grid -->
  <div *ngIf="!loading" class="row">
    <div *ngFor="let property of properties" class="col-lg-4 col-md-6 mb-4">
      <div class="property-card">
        <div class="property-image-container">
          <img 
            [src]="property.images?.[0] || 'https://images.pexels.com/photos/186077/pexels-photo-186077.jpeg?auto=compress&cs=tinysrgb&w=400&h=250&fit=crop'"
            alt="{{ property.title }}"
            class="property-image">
          <div class="property-status">
            <span class="badge" [ngClass]="getStatusClass(property.status)">
              {{ property.status }}
            </span>
          </div>
          <div class="property-actions">
            <button class="btn btn-sm btn-light" (click)="openModal(property)" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteProperty(property)" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        
        <div class="property-content">
          <h5 class="property-title">{{ property.title }}</h5>
          <p class="property-location">
            <i class="fas fa-map-marker-alt me-1"></i>
            {{ property.location.city }}, {{ property.location.state }}
          </p>
          <p class="property-description">{{ property.description | slice:0:80 }}...</p>
          
          <div class="property-features">
            <span class="feature">
              <i class="fas fa-bed me-1"></i>
              {{ property.bedrooms }} bed
            </span>
            <span class="feature">
              <i class="fas fa-bath me-1"></i>
              {{ property.bathrooms }} bath
            </span>
            <span class="feature">
              <i class="fas fa-ruler-combined me-1"></i>
              {{ property.area }} sqft
            </span>
          </div>
          
          <div class="property-price">
            ${{ property.price | number:'1.0-0' }}/month
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="properties.length === 0" class="col-12">
      <div class="empty-state">
        <i class="fas fa-building"></i>
        <h4>No Properties Yet</h4>
        <p>Start by adding your first property listing</p>
        <button class="btn btn-primary" (click)="openModal()">
          <i class="fas fa-plus me-2"></i>
          Add New Property
        </button>
      </div>
    </div>
  </div>

  <!-- Property Modal -->
  <div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-building me-2"></i>
            {{ editingProperty ? 'Edit Property' : 'Add New Property' }}
          </h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        
        <form [formGroup]="propertyForm" (ngSubmit)="saveProperty()">
          <div class="modal-body">
            <!-- Basic Information -->
            <div class="section-header">
              <h6><i class="fas fa-info-circle me-2"></i>Basic Information</h6>
            </div>
            
            <div class="row">
              <div class="col-md-8 mb-3">
                <label class="form-label">Property Title *</label>
                <input 
                  type="text" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('title')"
                  formControlName="title"
                  placeholder="Enter property title">
                <div class="invalid-feedback">{{ getFieldError('title') }}</div>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Property Type *</label>
                <select 
                  class="form-select"
                  [class.is-invalid]="getFieldError('type')"
                  formControlName="type">
                  <option value="">Select type</option>
                  <option *ngFor="let type of propertyTypes" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
                <div class="invalid-feedback">{{ getFieldError('type') }}</div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Description *</label>
              <textarea 
                class="form-control"
                [class.is-invalid]="getFieldError('description')"
                formControlName="description"
                rows="3"
                placeholder="Describe your property..."></textarea>
              <div class="invalid-feedback">{{ getFieldError('description') }}</div>
            </div>

            <!-- Property Details -->
            <div class="section-header">
              <h6><i class="fas fa-home me-2"></i>Property Details</h6>
            </div>
            
            <div class="row">
              <div class="col-md-3 mb-3">
                <label class="form-label">Price/Month *</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input 
                    type="number" 
                    class="form-control"
                    [class.is-invalid]="getFieldError('price')"
                    formControlName="price"
                    placeholder="0">
                </div>
                <div class="invalid-feedback">{{ getFieldError('price') }}</div>
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Bedrooms *</label>
                <input 
                  type="number" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('bedrooms')"
                  formControlName="bedrooms"
                  placeholder="0">
                <div class="invalid-feedback">{{ getFieldError('bedrooms') }}</div>
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Bathrooms *</label>
                <input 
                  type="number" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('bathrooms')"
                  formControlName="bathrooms"
                  placeholder="0">
                <div class="invalid-feedback">{{ getFieldError('bathrooms') }}</div>
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Area (sqft) *</label>
                <input 
                  type="number" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('area')"
                  formControlName="area"
                  placeholder="0">
                <div class="invalid-feedback">{{ getFieldError('area') }}</div>
              </div>
            </div>

            <!-- Location -->
            <div class="section-header">
              <h6><i class="fas fa-map-marker-alt me-2"></i>Location</h6>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Address *</label>
              <input 
                type="text" 
                class="form-control"
                [class.is-invalid]="getFieldError('address')"
                formControlName="address"
                placeholder="Enter full address">
              <div class="invalid-feedback">{{ getFieldError('address') }}</div>
            </div>
            
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">City *</label>
                <input 
                  type="text" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('city')"
                  formControlName="city"
                  placeholder="City">
                <div class="invalid-feedback">{{ getFieldError('city') }}</div>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">State *</label>
                <input 
                  type="text" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('state')"
                  formControlName="state"
                  placeholder="State">
                <div class="invalid-feedback">{{ getFieldError('state') }}</div>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Zip Code *</label>
                <input 
                  type="text" 
                  class="form-control"
                  [class.is-invalid]="getFieldError('zipCode')"
                  formControlName="zipCode"
                  placeholder="12345">
                <div class="invalid-feedback">{{ getFieldError('zipCode') }}</div>
              </div>
            </div>

            <!-- Amenities -->
            <div class="section-header">
              <h6><i class="fas fa-star me-2"></i>Amenities</h6>
            </div>
            
            <div class="amenities-grid">
              <div *ngFor="let amenity of amenitiesList" class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  [checked]="isAmenitySelected(amenity)"
                  (change)="toggleAmenity(amenity)"
                  [id]="'amenity-' + amenity">
                <label class="form-check-label" [for]="'amenity-' + amenity">
                  {{ amenity }}
                </label>
              </div>
            </div>

            <!-- Images -->
            <div class="section-header">
              <h6><i class="fas fa-images me-2"></i>Property Images</h6>
            </div>
            
            <div class="mb-3">
              <input 
                type="file" 
                class="form-control"
                accept="image/*"
                multiple
                (change)="onImagesSelected($event)">
              <small class="text-muted">Select multiple images for your property</small>
            </div>
            
            <div *ngIf="imagePreviewUrls.length > 0" class="image-preview-grid">
              <div *ngFor="let url of imagePreviewUrls; let i = index" class="image-preview-item">
                <img [src]="url" alt="Preview" class="preview-image">
                <button type="button" class="btn btn-sm btn-danger remove-image" (click)="removeImage(i)">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              Cancel
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="propertyForm.invalid || saving">
              <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
              <i *ngIf="!saving" class="fas fa-save me-2"></i>
              {{ saving ? 'Saving...' : (editingProperty ? 'Update Property' : 'Create Property') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div *ngIf="showModal" class="modal-backdrop fade show" (click)="closeModal()"></div>
</div>