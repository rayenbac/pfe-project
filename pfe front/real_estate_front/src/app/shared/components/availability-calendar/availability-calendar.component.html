<div class="availability-calendar">
  <div class="calendar-header">
    <div class="calendar-navigation">
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="previousMonth()">
        <i class="fa fa-chevron-left"></i>
      </button>
      <h5 class="current-month">{{ months[currentMonth] }} {{ currentYear }}</h5>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="nextMonth()">
        <i class="fa fa-chevron-right"></i>
      </button>
      <button type="button" class="btn btn-outline-success btn-sm ml-3" (click)="refreshCalendar()" title="Refresh calendar">
        <i class="fa fa-sync-alt"></i> Refresh
      </button>
    </div>
    <div class="calendar-actions" *ngIf="selectedStartDate">
      <button type="button" class="btn btn-outline-danger btn-sm" (click)="clearSelection()">
        Clear Selection
      </button>
    </div>
  </div>

  <div class="calendar-legend">
    <div class="legend-item">
      <span class="legend-dot available"></span>
      <span>Available</span>
    </div>
    <div class="legend-item">
      <span class="legend-dot booked"></span>
      <span>Booked</span>
    </div>
    <div class="legend-item">
      <span class="legend-dot blocked"></span>
      <span>Blocked</span>
    </div>
    <div class="legend-item">
      <span class="legend-dot selected"></span>
      <span>Selected</span>
    </div>
  </div>

  <div class="calendar-body" *ngIf="!loading">
    <div class="calendar-weekdays">
      <div class="weekday">S</div>
      <div class="weekday">M</div>
      <div class="weekday">T</div>
      <div class="weekday">W</div>
      <div class="weekday">T</div>
      <div class="weekday">F</div>
      <div class="weekday">S</div>
    </div>

    <div class="calendar-weeks">
      <div class="calendar-week" *ngFor="let week of calendarDays">
        <div 
          class="calendar-day"
          *ngFor="let day of week"
          [ngClass]="{
            'available': day?.available && !day?.booked && !day?.blocked,
            'booked': day?.booked,
            'blocked': day?.blocked,
            'selected-start': day && isStartDate(day.date),
            'selected-end': day && isEndDate(day.date),
            'selected-individual': day && selectionMode === 'individual' && isSelectedDate(day.date),
            'in-range': day && selectionMode === 'range' && isDateInRange(day.date),
            'empty': !day
          }"
          (click)="onDateClick(day)"
          (mouseenter)="onDateHover(day)">
          
          <div class="day-content" *ngIf="day">
            <span class="day-number">{{ getDayNumber(day.date) }}</span>
            <span class="day-price" *ngIf="day.available && day.price > 0">
              ${{ day.price }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="calendar-loading" *ngIf="loading">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <div class="calendar-error" *ngIf="error">
    <div class="alert alert-danger">{{ error }}</div>
  </div>

  <div class="calendar-summary" *ngIf="selectedStartDate && selectedEndDate">
    <div class="selected-dates">
      <strong>Selected Dates:</strong>
      {{ selectedStartDate | date:'mediumDate' }} - {{ selectedEndDate | date:'mediumDate' }}
      <br>
      <span class="nights-count">{{ calculateNights(selectedStartDate, selectedEndDate) }} nights selected</span>
    </div>
  </div>
</div>
